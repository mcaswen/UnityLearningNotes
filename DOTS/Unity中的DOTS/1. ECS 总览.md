### 一、什么是`ECS`？
- **`Entity`（实体）**- **`Component`（组件）**- **`System`（系统）** 的缩写，是一种**数据为导向**的软件架构模式。
- 核心思想是将**数据（`Component`）和行为（`System`）** 分离，并通过**实体（`Entity`）** 来组合数据。

### 二、E-C-S的分别介绍
#### 1.`Entity` 实体
- **是什么**：是一个**标识符**或者**索引**（本质上是一个ID），不包含任何逻辑或数据。
- **工作方式**：所做的只是将多个`Component`组织在同一个**标识**之下，从而模拟一个游戏对象`GameObject`，这样的模拟比传统`GameObject`来说更加轻量级，且没有可能**增加开销的默认组件**。
#### 2. `Component` 组件
- **是什么**：**纯数据**结构（`Struct`），不包含任何方法（逻辑）。只用于保存状态。
- **工作方式**：就像传统模式下的`Component`，但去掉了所有方法，只剩下**数据**字段，是`ECS`的**核心**，占据主导地位。
- **例如**：
	- `PositionComponent`：只包含 `float3 position`字段。
    
	- `RotationComponent`：只包含 `quaternion rotation`字段。
    
	- `HealthComponent`：只包含 `float currentHealth, float maxHealth`字段。
#### 3. `System` 系统
- **是什么**：**纯逻辑**，不存储任何数据或状态。负责处理拥有**特定`Component`** 的`Entity`。
- **工作方式**：一个`System`会批量处理所有携带特定`Component`的`Entity`，并对这些`Entity`的`Component`数据进行操作。它就像传统模式下一个`MonoBehaviour`的`Update()`方法，但它**不是挂载在某个对象上的**，而是全局的，批量处理**所有**符合条件的对象的。
- **例如**：
-  `MovementSystem`：遍历所有拥有 `PositionComponent`和 `VelocityComponent`的实体，根据速度更新它们的位置。
    
- `DamageSystem`：遍历所有拥有 `HealthComponent`和 `RecentlyDamagedComponent`的实体，计算并扣除它们的生命值。

### 三、`ECS`的核心优势
- 与传统的`MonoBehaviour`/`GameObject`模式相比，`ECS`架构模式的核心优势在于其**极致的性能**
#### 1. 缓存友好性
- **传统模式问题**：`MonoBehaviour`和`GameObject`在内存中是分散存储的（通过指针引用）。`CPU`在访问它们时缓存命中率低，导致性能瓶颈（“缓存未命中”）。

- **`ECS`解决方案**：相同类型的`Component`数据在内存中时连续紧密排列的（`Archetype`架构）。当`System`遍历这些数据时，CPU可以十分高效地将一大块数据加载到高速缓存中，顺序读取，极大提升了处理速度。这时`ECS`性能提升的最关键因素。

#### 2. 多线程支持
- **传统模式问题**：虽然Unity提供了`JobSystem`，但与传统`MonoBehaviour`组合使用时，**数据依赖**和**竞争条件**使得线程的管理十分复杂。

- **`ECS`解决方案**：由于**数据与逻辑分离**（`Component`与`System`），且数据布局是**线性**的，可以非常轻松，安全地将`System`分散到多个线程上并行执行（通过`IJobEntity`等），充分利用多核心`CPU`。

#### 3. 网络同步支持
- **传统模式问题**：在`Netcode For GameObject`或其他传统框架下，游戏需要同步一个标记为需同步的`GameObject`的**每一个状态**变化，带来了性能开销。与此同时，逻辑与数据的**强耦合性**也使得**网络预测与回滚**的复杂性和不确定性大大增加。

- **`ECS`解决方案**：因为`System`是纯函数，它的输出只依赖于输入（`Component`数据+时间`DeltaTime`）。只要所有客户端的初始状态和输入指令一致，所有`System`的运行结果就会完全一致。这使得**状态同步**和**锁步网络模型**变得十分简单可靠，对**对象快照**（纯数据）的存储代价和回滚操作开销也更小。

#### 4. 关注点分离
- 数据和逻辑清晰分离是的代码更易于理解，测试和维护。`System`职责单一,`Component`结构清晰。

#### 5. 可拓展性
- 可以轻松处理成千上万实体，而性能开销几乎线性增长，非常适合需要模拟大量对象的应用场景。

### 四、`Unity`的`ECS`实现：`DOTS`
Unity将`ECS`与另外两个系统捆绑在一起，合称为**DOTS(Data-Oriented Technology Stack)**，即**面向数据的技术栈**。
##### 1.`ECS`
- 如上所述，是架构核心
##### 2. C# `JobSystem`
- 用于编写安全，高效的多线程代码。`ECS`的`System`通常使用`Job`来并行处理数据。
##### 3. Burst Compiler
- 一个高性能的编译器，能将C# Job代码编译成高度优化的本地机器码，进一步提升性能。
