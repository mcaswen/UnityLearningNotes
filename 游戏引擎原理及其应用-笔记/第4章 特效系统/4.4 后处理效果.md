#### 概述
后处理效果 `Post Processing`，用于描述在摄像机绘制场景后，场景在屏幕上呈现之前所进行的全屏幕图像处理效果。

经常被用于模拟物理摄像机和电影的特效
- 如景深、颜色滤镜、白平衡等

#### 渲染管线的兼容性
- **`Built-In`**
	- 支持一些基础的后处理效果
	- 如泛光 `Bloom`、颜色分级 `Color Grading`、`Depth of Field` 景深、`Lens Distortion` 镜头畸变等
- **`URP`**
	- 支持更多的后处理效果
	- 如抗锯齿、屏幕空间反射、环境光遮蔽 `AO`和运动模糊等

#### 高动态范围成像
- 后处理技术的实现通常需要支持高动态范围（`HDR`）渲染
- 使用`HDR`的优势有以下四个方面：
	- **动态范围扩展**
		- 后处理通常需要对图像进行调整、过滤或合成
		- 这可能导致图形的动态范围变化
		- `LDR`下，可能会导致图像的信息丢失或失真

	- **更好的颜色精度**
		- 后处理通常还要对颜色进行调整、滤波等操作
		- 这些操作需要更高颜色精度来保证效果

	- **更好的光照效果**
		- 后处理中的很多操作需要对光照进行处理
		- 如`Bloom`反光、`Lens Flare`镜头光晕等
		
		- **更好的抗锯齿效果**
		- 后处理中的抗锯齿通常使用多重采样抗锯齿（`MSAA`）
		- `LDR`中，`MSAA`可能导致颜色失真

##### **Unity中的后处理效果设置**
- 需修改项目中的`Pipeline asset`文件设置
- 在`Post-processing`一栏中，将`Grading Mode`由`LDR`修改为`HDR`

#### **典型后处理特效**
- **泛光 `Bloom`**
	- 通过图像处理算法，将高亮的像素向外扩张形成光晕
	- 生动地表达太阳、霓虹灯等光源的亮度
	- 对于优秀的泛光特效来说，需要满足以下几个特点
		1. 发光物边缘向外“扩张”的足够大
		2. 发光物中心足够亮
		3. 该亮的地方（如火把、灯芯）药量，不该亮的地方（如白色墙壁、皮肤）不亮

- **渐晕 `Vignette`**
	- 模拟相机镜头的光晕效果
	- 在图像周围降低亮度并添加柔和的黑色边框
	- 制造出一种老照片效果


#### **后处理特效实现原理**
- **泛光 `Bloom`**
	- 首先提取出屏幕上的光亮区域，这些区域的亮度可能高于1.0
	- 然后在一个小纹理中模糊它们
	- 这样它们就会扩散到周围的区域
	- 这个模糊过程需要在`HDR`空间中完成，否则会丢失一些亮度信息

#### Unity中的后处理特效实践
- **泛光 `Bloom`**
	- **`Threshold`**：
		- 最小亮度阈值，只有大于该阈值的像素才会被处理
		- 设置为2.3-2.65
		- 用于避免对低亮度区域的过度处理

	- **`Intensity`**：
		- `Bloom`处理后的亮度增益
		- 设置为1.5-2.5
		- 增加该值可以使得`Bloom`效果更加明显
	
	- **`Scatter`**：
		- 表示`Bloom`的散射程度
		- 设置为0.4-0.6
		- 增加该值会使得`Bloom`更加模糊
	
	- **`Tint`**：
		- 设置`Bloom`处理后光的颜色
		- 设置为白色，表示不对颜色进行额外调整

	- **`Clamp`**：
		- 用于控制`Bloom`处理后的光强度上限
		- 设置为12
		- 超过该强度的光会被裁剪，避免产生过曝

- **渐晕 `Vignette`**
	- 可通过`Post Processing Stack`实现
	- 或自己编写自定义`Shader`
	- `Post Processing Stack` 中可设置形状，强度，中心位置等参数
		- **`Color`**：
			- 设置暗角的颜色，一般设置为黑色
		- **`Intensity`**：
			- 设置暗角的强度，这里设置为0.3左右，适度增加画面对比度
		- **`Smoothness`**：
			- 设置暗角的平滑程度，这里设置为0.5左右，使暗角过渡平滑